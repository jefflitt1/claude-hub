# Session Recap: mac_20260131_1247
**Time:** 2026-01-31 12:47
**Terminal:** Mac Studio

## Completed
- Researched best practices for training local LLM (DeepSeek R1 14B) for email classification
- Designed 3-phase ML improvement approach: Phase 1 (pgvector few-shot), Phase 2 (LoRA fine-tuning at 500+ corrections), Phase 3 (self-improving pipeline)
- Set up MLX-LM Python venv at ~/mlx-env for future LoRA fine-tuning on Apple Silicon
- Created Email Review UI page at /jgl/email-review on JGL dashboard (filterable table, correction dialog, stats, pagination)
- Added Email Review nav link to JGLDashboard.tsx header
- Created and ran migration 009_email_examples_pgvector.sql in Supabase:
  - jeff_email_examples table with VECTOR(384) for nomic-embed-text embeddings
  - HNSW index for cosine similarity search
  - find_similar_email_examples() function for few-shot retrieval
  - add_email_example_from_correction() function (auto-creates example from user correction)
  - seed_email_examples_from_classifications() function
  - classification_metrics view (weekly accuracy by category)
  - Trigger: auto-creates example when classification corrected
- Fixed n8n Email Classification Pipeline (db50ZNo16dTNcfAY) - 8 bugs:
  1. Gmail field capitalization (From/Subject not from/subject)
  2. Account detection from To field (not missing _account)
  3. DeepSeek R1 thinking vs response field parsing
  4. JSON wrapped in markdown fencing
  5. num_predict too low (200→500)
  6. Timeout too short (30s→90s)
  7. Missing Insert Classification Record node (data never reached jeff_email_classifications)
  8. Regex parser for truncated JSON responses
- Pushed frontend changes to GitHub (syncs to Lovable)

## Decisions Made
- Phase 1 (pgvector few-shot) before Phase 2 (LoRA fine-tuning) - simpler, immediate improvement
- Email Review UI on jgl.l7-partners.com dashboard (not separate app)
- VECTOR(384) dimension for nomic-embed-text embeddings
- MLX framework for future fine-tuning (Apple Silicon native)

## New Open Items
- Clean up 38 garbage rows in jeff_email_threads: `DELETE FROM jeff_email_threads WHERE from_email = 'Unknown' AND classified_by = 'deepseek-r1:14b-fallback';`
- Verify next n8n workflow execution produces proper classifications with final parse fix
- Build embedding generation workflow for email examples using nomic-embed-text
- Modify n8n classification workflow to call find_similar_email_examples() for few-shot prompting
- Build real estate listing extraction pipeline (dedicated prompt → listing_inbox table → weekly digest)
- LoRA fine-tuning when 500+ corrections accumulated

## Notes
- DeepSeek R1 model quirk: puts reasoning in `thinking` field, sometimes JSON only in `thinking` not `response`
- n8n Gmail node v2.1 returns capitalized field names (From, Subject, To)
- Seeding returned 0 because jeff_email_classifications was empty (pipeline wasn't writing to it)

# Session Recap: mac_20260127_1400
**Time:** 2026-01-27 14:00
**Terminal:** mac (MacBook Pro)
**Est. Tokens:** ~80000

## Completed
- Modified n8n Mac Studio Daily Backup workflow to only send Telegram notifications on failure (not success)
- Upgraded Uptime Kuma from v1 to v2 on Raspberry Pi with Watchtower auto-updates
- Added 15 Cloudflare subdomain monitors to Uptime Kuma with Telegram notifications
- Fixed Kuma v2 Socket.IO API differences (conditions field, 3-arg addNotification, object notificationIDList format)
- Fixed Claude API and Supabase monitors accepting 401/502 as "reachable"
- Investigated Supabase hosting: confirmed local Pi instance is empty (0 public tables), all data on cloud (donnmhbwhpjlmpnwgdqr)
- Removed 16 Docker containers from Pi: 13 Supabase + Elasticsearch + Kibana + Weaviate
- Pi resources: 24 containers → 7, swap 100% → 7%, RAM 6GB → 2.5GB used
- Cleaned 3 stale Pi cron entries (monitor_supabase.sh, backup-supabase.sh, monitor_appsmith.sh)
- Removed dead Cloudflare tunnel route: supabase.l7-partners.com → localhost:8081
- Deleted 3 dead Cloudflare DNS records: supabase, claude-api, ollama (.l7-partners.com)
- Recreated 13 Uptime Kuma monitors with Telegram alerts (after accidental wipe during cleanup)
- Added cloud Supabase monitor (donnmhbwhpjlmpnwgdqr.supabase.co)
- Set up nightly Supabase backup on Mac Studio (tested: 244K compressed, 339K schema + 970K data)
- Extracted Supabase access token from local keychain, deployed to Mac Studio
- Fixed backup script: zshrc sourcing issue, missing project link, added --workdir flag
- Backup cron: 3:30 AM daily at /Users/jgl/backups/supabase/backup-supabase-cloud.sh
- Evaluated and removed Metabase (unused since Sep 2025, freed 886MB disk + 512MB-1GB RAM)
- Audited Redis (active, 19 keys for n8n Bull queue - keep), Beszel (lightweight monitoring - keep)
- Reviewed n8n notification system: Self-Healing Monitor active but simpler than documented
- Confirmed admin.l7-partners.com already deployed via Netlify (Lovable-built React SPA in l7partners-rewrite repo)
- Created comprehensive Apple Note "Pi Infrastructure Follow-up Items" with all findings

## Decisions Made
- Mac Studio for Supabase backups (240GB free, Thunderbolt speed) over Pi
- Keep cloud-only Supabase; nightly Mac Studio backup provides local data copy
- Redis required (n8n Bull queue dependency), keep on Pi
- Beszel lightweight monitoring, keep on Pi
- Metabase removed (single-day experiment from Sep 2025, never revisited)
- Weaviate removed (empty, never configured with n8n)
- 4TB drive recommended for Mac Studio (not physically connected yet)
- admin.l7-partners.com already functional as alias to l7partners-rewrite Netlify deployment

## New Open Items
- 4TB external drive needs to be physically connected to Mac Studio, then format and configure
- Consider activating inactive n8n workflows: Critical Workflow Monitor, Daily Workflow Health Report
- Mac Studio has 2 Cloudflare tunnel IDs - consider consolidating
- Kuma monitors 5 (Claude API) and 12 (Ollama) may need removal since DNS records were deleted
- Supabase backup pg_dump warns about circular FK constraints (profiles/leases_legacy, claude_projects)

## Notes
- Supabase dashboard was in scheduled maintenance throughout session - used keychain extraction for token
- Kuma v2 API significantly different from v1: conditions NOT NULL, 3-arg addNotification, object notificationIDList
- Pi final state: 7 containers (n8n, redis, watchtower, task-runners, uptime-kuma, beszel, cloudflared)
- Cloudflare tunnel (Pi): 5 active routes (n8n, webhooks, metabase, ssh, kuma)
- Cloudflare tunnel (Studio): 3 active routes (chat, studio-ssh, mac-ssh)
